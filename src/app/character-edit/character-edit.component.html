<app-page-shell>
  <div class="character-edit-content">
    <div class="character-edit-content__header">
      <button
        class="character-edit__header__back-button btn d-flex p-0 align-items-center gap-2"
        (click)="back()"
        aria-label="Back to character editing">
        <img
          class="character-edit__header__back-button__icon"
          src="/assets/ui/chevron.png"
          alt="Back arrow"
          aria-hidden="true" />
        <span class="character-edit__header__back-button__text">
          Karakterek szerkesztése
        </span>
      </button>
      <app-dynamic-button
        [text]="'Új karakter hozzáadása'"
        [variant]="'outline'"
        data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasRight"
        (onClick)="addCharacter()" />
    </div>

    <div class="table-responsive">
      <table
        class="table table-sm table-dark table-hover"
        aria-label="Character list">
        <thead>
          <tr>
            <th
              scope="col"
              style="width: 25%"
              (click)="sort('name')"
              [attr.aria-sort]="getSortDirection('name')"
              tabindex="0"
              role="button"
              aria-label="Sort by name">
              <span class="th-cell">
                <span> NÉV </span>
                @if (isSortedColumn('name')) {
                  <span class="sort-indicator">
                    {{ sortDirection() === 'asc' ? '▲' : '▼' }}
                  </span>
                }
              </span>
            </th>
            <th
              scope="col"
              style="width: 12%"
              (click)="sort('side')"
              [attr.aria-sort]="getSortDirection('side')"
              tabindex="0"
              role="button"
              aria-label="Sort by side">
              <span class="th-cell">
                <span> OLDAL </span>
                @if (isSortedColumn('side')) {
                  <span class="sort-indicator">
                    {{ sortDirection() === 'asc' ? '▲' : '▼' }}
                  </span>
                }
              </span>
            </th>
            <th
              scope="col"
              style="width: 20%"
              (click)="sort('power')"
              [attr.aria-sort]="getSortDirection('power')"
              tabindex="0"
              role="button"
              aria-label="Sort by power">
              <span class="th-cell">
                <span> KÜLÖNLEGES ERŐ </span>
                @if (isSortedColumn('power')) {
                  <span class="sort-indicator" *ngIf="isSortedColumn('power')">
                    {{ sortDirection() === 'asc' ? '▲' : '▼' }}
                  </span>
                }
              </span>
            </th>
            <th
              scope="col"
              style="width: 15%"
              (click)="sort('midichlorian')"
              [attr.aria-sort]="getSortDirection('midichlorian')"
              tabindex="0"
              role="button"
              aria-label="Sort by midichlorian">
              <span class="th-cell">
                <span> MIDIKLORIÁN </span>
                @if (isSortedColumn('midichlorian')) {
                  <span class="sort-indicator">
                    {{ sortDirection() === 'asc' ? '▲' : '▼' }}
                  </span>
                }
              </span>
            </th>
            <th scope="col" style="width: 33%"></th>
          </tr>
        </thead>
        <tbody>
          @for (character of characters(); track character.uuid) {
            <tr>
              <td>{{ character.name }}</td>
              <td>{{ character.side === Side.DARK ? 'Sötét' : 'Világos' }}</td>
              <td>{{ character.abilities.power }}</td>
              <td>{{ character.abilities.midichlorian }}</td>
              <td class="actions">
                <div class="button-wrapper">
                  <app-dynamic-button
                    text="Másolás"
                    variant="simple"
                    (onClick)="copyCharacter(character)"
                    textColor="white" />
                  <app-dynamic-button
                    text="Módosítás"
                    variant="simple"
                    data-bs-toggle="offcanvas"
                    data-bs-target="#offcanvasRight"
                    (onClick)="editCharacter(character)"
                    textColor="#f7b500" />
                  <app-dynamic-button
                    text="Törlés"
                    variant="simple"
                    (onClick)="deleteCharacter(character)"
                    textColor="#ff3232" />
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <div
    class="offcanvas offcanvas-end"
    tabindex="-1"
    id="offcanvasRight"
    aria-labelledby="offcanvasRightLabel">
    <app-character-sidebar [character]="selectedCharacter()" />
  </div>
</app-page-shell>
