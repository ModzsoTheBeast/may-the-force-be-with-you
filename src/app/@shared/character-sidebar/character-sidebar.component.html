<div class="offcanvas-header">
  <h5 id="offcanvasRightLabel">
    Karakter {{ character() ? "hozzáadása" : "szerkesztése" }}
  </h5>
  <button
    type="button"
    class="btn-close text-reset"
    data-bs-dismiss="offcanvas"
    aria-label="Close"
  ></button>
</div>
<div class="offcanvas-body">
  <form (ngSubmit)="submit()">
    <div class="input-group mb-3">
      <label>Avatár kiválasztása</label>
      <div class="d-flex flex-row g-1 overflow-x-auto">
          @for (character of characters; track character.uuid) {
          @let selectedCharPicture = characterForm.controls.avatar.value ===
          character.id;
              <app-character-image
            [characterId]="character.id"
            [hasBackground]="selectedCharPicture"
            [selectable]="true"
            [customImageStyle]="{padding: 0, width: '150px'}"
            (onClickEvent)="
              this.characterForm.controls.avatar.setValue(character.id)
            "
          />
          }
      </div>
    </div>
    <div class="input-grid">
      @let nameControl = characterForm.controls.name; @let sideControl =
      characterForm.controls.side; @let powerControl =
      characterForm.controls.power; @let midiclorianControl =
      characterForm.controls.midiclorian;
      <div class="mb-3">
        <label class="form-label" for="name-input">Név</label>
        <input
          id="name-input"
          class="form-control"
          [formControl]="nameControl"
          [class.is-invalid]="nameControl.invalid && !nameControl.untouched"
          type="text"
        />
        @if (nameControl.hasError('required') && !nameControl.untouched) {
        <div class="invalid-feedback">Kötelező!</div>
        }
      </div>

      <div class="mb-3">
        <label class="form-label" for="side-select">Oldal</label>
        <select
          class="form-select"
          id="side-select"
          [formControl]="sideControl"
        >
          <option [value]="Side.DARK">Sötét</option>
          <option [value]="Side.LIGHT">Világos</option></select
        >
      </div>

      <div class="mb-3">
        <label class="form-label" for="power-select">Különleges erő</label>
        <select
          class="form-select"
          id="power-select"
          [formControl]="powerControl"
        >
          <option [value]="'Erő használata'">Erő használata</option>
          <option [value]="'Kibernetikus test'">Kibernetikus test</option>
          <option [value]="'Harcászati tapasztalat'">
            Harcászati tapasztalat
          </option>
          <option [value]="'Űrcsempész'">Űrcsempész</option>
          <option [value]="'Péncélzat'">Péncélzat</option>
          <option [value]="'Fehér páncélzat'">Fehér páncélzat</option></select
        >
      </div>

      <div class="mb-3">
        <label class="form-label" for="midi-input">Midikloriánok</label>
        <input
          id="midi-input"
          class="form-control"
          [formControl]="midiclorianControl"
          [class.is-invalid]="
            midiclorianControl.invalid && !midiclorianControl.untouched
          "
          type="text"
        />
        @if (midiclorianControl.hasError('required') &&
        !midiclorianControl.untouched) {
        <div class="invalid-feedback">Kötelező!</div>
        }
      </div>
    </div>

    <div class="mb-3">
      <label for="description-label" class="form-label">Description</label>
      <textarea class="form-control" id="description-label" rows="3" [formControl]="characterForm.controls.description"></textarea>
    </div>

    @let char = character(); @if (char) {
    <div class="time-info form-label">
      <label for="counter">Karakter létrehozás óta eltelt idő:</label>
      <p id="counter">{{ (elapsedSeconds$ | async) ?? 0 | elapsedTime }}</p>
    </div>
    }
    <div class="actions-wrapper">
      <app-dynamic-button
        class="w-100"
        [text]="'Mégsem'"
        [customStyle]="{ width: '100%', color: 'black' }"
        [variant]="'outline'"
        (onClick)="cancel()"
      />
      <app-dynamic-button
        class="w-100"
        [text]="'Mentés'"
        [type]="'submit'"
        [customStyle]="{ width: '100%' }"
      />
    </div>
  </form>
</div>
